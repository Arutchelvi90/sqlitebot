#summary discussion of initial starcraft bot effort

This is a discussion of some [http://code.google.com/p/sqlitebot/source/browse/trunk/starcraft/v1.0/BasicAIModule.cpp sample C++ code] extended from the [http://code.google.com/p/bwsal BWSAL] AI example.  Many thanks to the [http://code.google.com/p/bwapi BWAPI], [http://code.google.com/p/bwsal BWSAL] and [http://code.google.com/p/bwapi BWTA] teams/individuals/projects for providing these useful game interfaces and examples to program on top of, and [http://www.youtube.com/watch?v=PbjsL5E1Idw Ben Weber] for organizing the [http://eis.ucsc.edu/StarCraftAICompetition Starcraft AI competition] whose competitors will be leveraging these tools.

My apologies up front for my poor C++ coding style/indentation - I learned Unix/C(or failed to learn depending on your perspective ;) a long time ago(in a galaxy far,far away) back in university classes and the past several years been more programming with Linux/perl/php(wanting to pick up more python) - so I'm having to grow a familiarity with Microsoft's Visual C++ Express environment and standard(std) libraries as I go.  If anyone wants to suggest a pretty-print utility(or function within the editor I'm unaware of) for the code I can give that a whirl as long as it doesn't muck up the code too much.

If you find these code examples useful, feel free to reuse them, but also please give me some acknowledgement by email that I might keep a public list of.  Also I would be glad to learn, share and incorporate others work into a more robust AI, so email if you have something to contribute in the way of development,testing,documentation,etc.

I'd like to see what more open-source,open-data,crowd-sourcing,datamining,collaborative approaches such as the [http://en.wikipedia.org/wiki/Netflix_Prize Netflix prize] as applied to game AI can provide both businesses and customers of AI-based products.

----
The easiest way to follow-along with the below discussion is to look at the side-by-side comparison in the code in the diff page below - I'll be referencing line numbers on the right-hand side that differ from the initial example.

Code diff page
http://code.google.com/p/sqlitebot/source/diff?spec=svn250&r=250&format=side&path=/trunk/starcraft/v1.0/BasicAIModule.cpp

If I don't reference line numbers below, its because it was something experimental that didn't work out for now.

<wiki:toc max_depth="6">
----
= Outline = 

The basics of an initial approach can be broken into the following 4 sections.

  * Build
  * onShow
  * onDestroy
  * checkIdle

My very first approach started with the default terran vulture(vehicle) build, but vultures don't have any air attack, so I switched to marines - lots and lots of marines.

Also I'm testing for now exclusively with terran vs terran matches - later on will consider zerg and protoss strategies, but trying to minimize the complexity of issues to work through for now.

Line #36-43 are global vars, that I reference later.

line #36 enableStart is set to true if you're running the AI from the very beginning of the game and set to false if you're testing the game after the initial build orders are complete.  Otherwise if you restart the game from a saved game midway, the AI will try to rebuild everything again.  There may also be some bugs/side-effects from running/testing this way in regards to how the Arbitrator or other BWSAL code(planning arrays that are populated at game begin) runs with regards to the assumption the game is always run from a clean start.

line #38 countTroop - how many troops do we have?

line #39 attackStrength - some minimum troop level before engaging an attack

line #40 scoutStrength - some minimum troop level before engaging scout(s)

line #42 myBase - pointer to our home command center unit

line #43 baseRadius - a distance radius from the base to help the AI differentiate between attacks on our home base(less than) and attacks in the field(greater than)

== Build == 

line #117-118, 144-208

The initial build order is critical in quickly setting up the kind of production units needed for the strategies/tactics the AI expects to run.  This build order is for a marine/medic mob/attack/defense tactic.  You can experiment with the build order to see how quickly certain units can be produced with what capabilities - against the default game AI, some basic initial defense is needed to prevent from being overtaken by a possible aggressive initial rush.  The BWSAL building routines do a good job of placing building in a well-spaced spiraling outward fashion, but will unfortunately place some building units on the other side of walls and missile turrets without any tactical defense reference(near chokepoints or towards enemy approaches).

== onFrame ==

Not much happening here except for a hook to periodically call checkIdle function

line #227 commented this out as it seemed the update functions might not be getting called in some cases

line #242-246 commented out the scout function call, set a trigger on this behavior later - the default scout when I tested pulled one of my SCV's and after the scout was killed or finished a circuit of the map bases - the scout routine was finished and no further scouting went on.  Still need a good scout function - particularly for subgroups/areas.

line #278 calls checkIdle function about once a second

== onUnitDestroy == 

#line 291-325 very simple functions to simply rebuild whatever matched units or buildings are destroyed

== onUnitShow ==

This is the first event that registers the sight of another unit from the fog of war, so if filtering for enemy units, can start a reaction here.

line #332-356 these are some basic preconditions before attacking, such as
  * keeping track of the last attack time so that units don't spaz out switching between possible new targets
  * not attacking distant targets till some minimum troop attackStrength is met
  * making sure targets are enemies and not self,neutrals,etc

line #360-386 this basically reassigns the unit position=target variable(probably not necessary) and sends ground attack troops directly to the target.  I also tried experimenting with keeping track of the troop unit closest to the target(closestTarget) with the idea that support troops(medics,flyers) should stay behind the front-line of attack, this kind of worked but also failed because the distance function I need is really a ground travel distance and not a bee-line/air distance - so in cases where troops round a corner to an attack the support units would sometimes go backwards away from the front.

line #388-411 special case handling for support troop medics and science vessel

Also on a side-note, when playing the default game AI I had to include the science vessel to counteract the AI's use of cloaked ghosts/wraiths and medic 'restoration' tech to combat enemy medic use of ocular flare to 'blind' my science vessel(which makes the science vessel useless as a cloak detector).

== checkIdle == 

line #467-549 this establishes variable counts for the following debug line in-game 

Broodwar->sendText("g:%d:m:%d:t:%d:i:%d:im:%d",gasWorkers,mineralWorkers,countTroop,totalIdle,idleMob);

which are used by other parts of the code to assign workers or establish attack strength/readiness.

Also the unit loop looks for 'hurt' units and sends support troops(medic,science vessel) to the hurt unit.

line #550-602 assign workers to minerals or gas

line #608-642 assign workers to repairs closest to where they are - keeps an array of assigned repair workers so not all workers go to the same repair

line #643-671 this started as a minimal base defense measure - the onUnitShow basically handles most cases, but sometimes an enemy unit might be already be within a home base area attacking and new units produced would not have received the earlier attack order, so this is just a catch-all forcing all units to attack any visible enemy units.  If the enemy is within the baseRadius, troops have to focus on the enemy threat, if the enemy is located far away, then they attack if idle(not already engaged in a firefight).  This also helps keep troops busy firing and from idling during an enemy base attack. 

----
= Issues =

  # Resources management is still flaky - tried using the default BWSAL workerManagement for minerals and gas, but the workers were idle after the mineral field was exhausted.  Workers will also sometimes all go to a depleted gas refinery instead of seeking new resources.  Workers also idle unexpectedly, I think this is related to some timing issues in the build process/planner.
  # Need to work on a scout - currently the AI doesn't actively scout for the enemy and will remain at home base unless slowly drawn by a series of attacks back to the enemy base - so for testing now I'll manually grab a troop and send him to an enemy base to trigger an attack.
  # Support troops - did a lot of experimenting with medics and science vessels to try and get support troops to move with the group but not get ahead of the line of fire and in the cross-fire or over into enemy lines.  Sometimes the isIdle function did not seem to be working and had problems essentially with either support troops with either lagging or leading the front line of attack
  # AI pathing - mentioned my requests regarding pathing info to the BWAPI team at http://code.google.com/p/bwapi/issues/detail?id=190  While it should be possible to do an A`*` or other pathing algorithm on client-side from the map analysis data, it may be easier to reuse the game pathing or someone else's work on this.






----
= Next steps = 

----
= Links = 

http://medialogics.com/ma/strategies/starcraft_strategy_guide_6.html <br/>
http://classic.battle.net/scc/GS/